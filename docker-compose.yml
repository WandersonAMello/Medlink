# docker-compose.yml

version: '3.8'

services:
  app:
    build: .
    container_name: medlink_app
    ports:
      - "5000:5000"
    volumes:
      - ./app:/app
    environment:
      # A linha abaixo é a correção final.
      # Aponta explicitamente para a função create_app dentro do pacote app.
      - FLASK_APP=app:create_app
      - FLASK_DEBUG=1
      - DATABASE_URL=postgresql://admin:admin@db:5432/medlink_db
    depends_on:
      - db
  # Serviço do Banco de Dados PostgreSQL
  db:
    image: postgres:15-alpine  # Usa a imagem oficial do PostgreSQL (versão leve 'alpine')
    container_name: medlink_db
    environment:
      POSTGRES_DB: medlink_db
      POSTGRES_USER: admin
      POSTGRES_PASSWORD: admin
    ports:
      - "5432:5432"  # Expõe a porta do PostgreSQL para o host (útil para debug)
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./db_init:/docker-entrypoint-initdb.d  # Persiste os dados do banco em um volume nomeado

# Declaração do volume nomeado para persistência de dados
volumes:
  postgres_data: